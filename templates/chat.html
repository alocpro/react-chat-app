{% extends "base.html" %}

{% block page_name %}Chat{% endblock %}

{% block page_js %}
    <script src="{{media_url}}/js/lib/underscore.js" type="text/javascript"></script>
    <script src="{{media_url}}/js/lib/backbone.js" type="text/javascript"></script>
    <script src="{{media_url}}/js/clientGUI.js" type="text/javascript"></script>
	<script src="{{media_url}}/js/client.js" type="text/javascript"></script>
	<script type="text/javascript">
		$(function() {
            var config = {
                room: '{{room.id}}',
                host: '{{host}}',
                port: {{port}},
                transports: ['websocket', 'flashsocket']
            }
			client = new Client(config).start();
		});
	</script>
{% endblock %}

{% block body_class %}page-chat{% endblock %}

{% block content %}
	<header class="navbar">
        <div id="rooms-menu" class="tabs">
            <ul>
                <li class="fixed tab">
                    <a href=# class="add-room"><i class="icon-th icon-white"></i></a>
                </li>
                <li class="tab selected">
                    <a class="room" data-room="dev">{{ room.name }}</a>
                </li>
                <li class="tab selected">
                    <a class="room" data-room="dev"><span class="text">eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee{{ room.name }}</span></a>
                </li>
                <li class="tab">
                    <a class="room" data-room="random">
                        <span class="text">Random Stuff</span>
                        <span class="badge badge-important">46</span>
                    </a>
                </li>
                <li class="tab">
                    <a href=# class="room" data-room="git">
                        <span class="text">Github</span>
                        <span class="badge badge-important">6</span>
                    </a>
                </li>
            </ul>
        </div>
		<div class="user dropdown pull-right">
			<a data-toggle="dropdown" href="#">
				<img class="avatar" src="http://www.gravatar.com/avatar/{{ user_avatar }}?s=50" />
				<span class="name">{{ user_firstname }} {{ user_lastname }}</span>
				<b class="caret"></b>
			</a>
			<ul class="dropdown-menu">
                <li><a data-toggle="modal" href="#edit-profile">Edit Profile</a></li>
				<li><a data-toggle="modal" href="#edit-account">Account Settings</a></li>
				<li><a data-toggle="modal" href="#set-name">Set Username</a></li>
				<li class="divider"></li>
				<li><a href="/logout">Logout</a></li>
			</ul>
		</div>
	</header>
	<div id="client">
        <div id="content">
            <div id="chat">
                <ul class="messages"></ul>
                <div id="entry" class="entry">
                    <textarea type="text" name="talk"></textarea>
                    <div class="buttons">
                        <button class="send btn btn-success">Send</button>
                    </div>
                </div>
            </div><!-- chat end -->
        </div><!-- content end -->
		<div id="sidebar">
			<div class="inner">
				<h1>{{ room.name }}</h1>
				<p>Where does the code go.</p>
				<div class="clear">
					<div class="btn-group buttons">
						<a class="btn" href="#">
							<i class="icon-comment"></i>
						</a>
						<a class="btn" href="#">
							<i class="icon-eye-close"></i>
						</a>
						<a class="btn" href="#">
							<i class="icon-cog"></i>
						</a>
					</div>
				</div>
				<div class="item-list">
					<div class="top">
						<h3><i class="icon-white icon-user"></i> Who's here</h3>
					</div>
					<ul id="user-list"></ul>
				</div>
                <div id="files" class="item-list">
					<div class="top">
						<h3>
							<i class="icon-white icon-film"></i> Media
						</h3>
						<a class="toggle-upload btn btn-dmb" href="#"><i class="icon-plus icon-white"></i><i class="icon-remove icon-white"></i></a>
					</div>
					<div class="upload hide">
						<form>
							<input id="fileupload" type="file" name="file" data-url="/ajax/upload-file" />
						</form>
					</div>
					<ul id="file-list"></ul>
				</div>
				<div id="status">
					<span class="message"></span>
					<span class="ping"></span>
				</div>
			</div>
		</div><!-- sidebar end -->
	</div>
{% endblock %}

{% block page_assets %}
	<div id="modals">
        <div id="new-room" class="modal hide fade">
            <form class="validate form-horizontal" action="/ajax/add-room" method="post">
                <div class="modal-header">
                    <h3>New Room</h3>
                </div>
                <div class="modal-body">
                    <div class="control-group">
                        <label class="control-label">Name</label>
                        <div class="controls">
                            <input class="required name" name="name" type="text" value="" />
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Description</label>
                        <div class="controls">
                            <textarea name="description"></textarea>
                        </div>
                    </div>
                    <p class="response"></p>
                </div>
                <div class="modal-footer">
                    <input type="submit" class="btn btn-success" name="submit" value="Create Room">
                </div>
            </form>
        </div>
        <div id="edit-room" class="modal hide fade">
            <form class="validate form-horizontal" action="/ajax/edit-room" method="post">
                <div class="modal-header">
                    <h3>Edit Room</h3>
                </div>
                <div class="modal-body">
                    <div class="control-group">
                        <label class="control-label">Name</label>
                        <div class="controls">
                            <input class="required name" name="name" type="text" value="" />
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Description</label>
                        <div class="controls">
                            <textarea name="description"></textarea>
                        </div>
                    </div>
                    <p class="response"></p>
                </div>
                <div class="modal-footer">
                    <input type="submit" class="btn btn-success" name="submit" value="Save">
                </div>
            </form>
        </div>
        <div id="edit-account" class="modal hide fade">
            <form class="validate form-horizontal" action="/ajax/update-account" method="post">
                <div class="modal-header">
                    <h3>Account Settings</h3>
                </div>
                <div class="modal-body">
                    <div class="control-group">
                        <label class="control-label">Email</label>
                        <div class="controls">
                            <input class="required email" name="email" type="text" value="{{ user_email }}" />
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Current Password</label>
                        <div class="controls">
                            <input class="required" name="current-password" type="password" />
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">New Password</label>
                        <div class="controls">
                            <input name="password" type="new-password" />
                        </div>
                    </div>
                    <p class="response"></p>
                </div>
                <div class="modal-footer">
                    <input type="submit" class="btn btn-success" name="submit" value="Save">
                </div>
            </form>
        </div>
        <div id="edit-profile" class="modal hide fade">
            <form class="validate form-horizontal" action="/ajax/update-profile" method="post">
                <div class="modal-header">
                    <h3>Profile Settings</h3>
                </div>
                <div class="modal-body">
                    <div class="control-group">
                        <label class="control-label">Display Name</label>
                        <div class="controls">
                            <input class="required" name="display-name" type="text" value="{{ user_displayname }}" />
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">First Name</label>
                        <div class="controls">
                            <input class="required" name="first-name" type="text" value="{{ user_firstname }}" />
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Last Name</label>
                        <div class="controls">
                            <input class="required" name="last-name" type="text" value="{{ user_lastname }}" />
                        </div>
                    </div>
                    <p class="response"></p>
                </div>
                <div class="modal-footer">
                    <input type="submit" class="btn btn-success" name="submit" value="Save">
                </div>
            </form>
        </div>
		<div id="set-name" class="modal hide fade">
			<div class="modal-header">
				<a href="#" class="close" data-dismiss="modal">&times;</a>
				<h3>Set Name</h3>
			</div>
			<div class="modal-body">
				<div class="form-horizontal">
					<div class="control-group">
						<label class="control-label" for="handle">Name</label>
						<div class="controls">
							<input id="handle" class="required" name="handle" size="12" type="text" minlength="4" maxlength="12" value="{{user_displayname}}" >
						</div>
					</div>
				</div>
			</div>
			<div class="modal-footer">
				<a href="#" class="btn btn-primary save" data-dismiss="modal">Set Name</a>
				<a href="#" class="btn" data-dismiss="modal">Cancel</a>
			</div>
		</div>
	</div>
	{% raw %}
		<div id="js-templates">
			<script id="js-tmpl-message" type="text/html">
				<li class="message {{#own}}own{{/own}}" data-id="{{id}}" data-owner="{{owner}}" data-posted="{{posted}}" data-room="{{room}}">
					<div class="side">
						<img class="avatar" src="http://www.gravatar.com/avatar/{{avatar}}?s=50" />
					</div>
					<div class="meta">
						<div class="top">
							<div class="name">{{name}}</div>
							<time></time>
						</div>
						<div class="text">
							<div class="fragments">
								<div class="fragment" data-id="{{id}}" data-posted="{{posted}}">{{text}}</div>
							</div>
						</div>
					</div>
				</li>
			</script>
			<script id="js-tmpl-message-fragment" type="text/html">
				<div class="fragment" data-id="{{id}}" data-posted="{{posted}}">{{text}}</div>
			</script>
			<script id="js-tmpl-event" type="text/html">
				<li class="message event">
					<div class="text">{{text}}</div>
				</li>
			</script>
			<script id="js-tmpl-user-list-item" type="text/html">
                <li class="user" data-id="{{id}}" data-cid="{{cid}}">
                    <img class="avatar" src="http://www.gravatar.com/avatar/{{avatar}}?s=50" />
                    <span class="name">{{name}}</span></li>
				</li>
			</script>
			<script id="js-tmpl-file-list-item" type="text/html">
                <li class="file" data-id="{{uid}}" data-uploaded="{{uploaded}}" data-size="{{size}}">
                    <a href="{{url}}" class="icon"><i class="icon-file"></i></a>
					<div class="meta">
						<a class="name" href="{{url}}" target="_blank">{{name}}</a>
						<span class="owner">via {{owner}}</span> &middot; <span class="size">{{size}}kb</span>
					</div>
				</li>
			</script>
		</div>
	{% endraw %}
{% endblock %}