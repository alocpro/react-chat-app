{% extends "base.html" %}

{% block page_name %}Chat{% endblock %}

{% block page_js %}
    <script src="{{media_url}}/js/lib/underscore.js" type="text/javascript"></script>
    <script src="{{media_url}}/js/lib/backbone.js" type="text/javascript"></script>
    <script src="{{media_url}}/js/clientGUI.js" type="text/javascript"></script>
	<script src="{{media_url}}/js/client.js" type="text/javascript"></script>
	<script type="text/javascript">
        var client;
		$(function() {
            var config = {
                room: '{{room.id}}',
                host: '{{host}}',
                port: {{port}},
                transports: ['websocket', 'flashsocket'],
                rooms: {
                    {% for room in rooms %}
                        '{{ room._id }}': {
                            id: '{{ room.id }}',
                            name: '{{ room.name }}',
                            description: '{{ room.description }}'
                        },
                    {% endfor %}
                }
            }
			client = new Client(config).start();
		});
	</script>
{% endblock %}

{% block body_class %}page-chat{% endblock %}

{% block content %}
<div id="client">
	<header class="navbar">
        <div id="rooms-menu" class="tabs">
            <ul>
                <li class="fixed tab">
                    <a href="#!/" class="home" data-id="home"><i class="icon-th icon-white"></i></a>
                </li>
                {% for room in rooms %}
                    <li class="tab">
                        <a class="room" href="#!/room/{{ room._id }}" data-id="{{ room._id }}">
                            <span class="text">{{ room.name }}</span>
                        </a>
                    </li>
                {% endfor %}
            </ul>
        </div>
		<div class="user dropdown pull-right">
			<a data-toggle="dropdown" href="#">
				<img class="avatar" src="http://www.gravatar.com/avatar/{{ user_avatar }}?s=50" />
				<span class="name">{{ user_firstname }} {{ user_lastname }}</span>
				<b class="caret"></b>
			</a>
			<ul class="dropdown-menu">
                <li><a data-toggle="modal" href="#edit-profile">Edit Profile</a></li>
				<li><a data-toggle="modal" href="#edit-account">Account Settings</a></li>
				<li><a data-toggle="modal" href="#set-name">Set Username</a></li>
				<li class="divider"></li>
				<li><a href="/logout">Logout</a></li>
			</ul>
		</div>
	</header>
	<div class="views">
        <div id="room-list" class="view" style="display: none;">
            <div class="main">
                <ul class="room-list list">
                    {% for room in rooms %}
                        <li class="room" data-id="{{ room._id }}">
                            <div class="inner">
                                <a href="#!/room/{{ room._id }}">
                                    <div class="name">{{ room.name }}</div>
                                    <div class="description">{{ room.description }}</div>
                                </a>
                            </div>
                        </li>
                    {% endfor %}
                </ul><!-- rooms list end -->
            </div><!-- main end -->
            <div class="sidebar">
                <h1><img src="/media/img/rooms.png" alt="Rooms"></h1>
                <a href=# class="btn btn-success btn-large">
                    <i class="icon-plus icon-white"></i> Create Room
                </a>
            </div>
        </div><!-- view end -->
	</div><!-- views end -->
</div><!-- client end -->
{% endblock %}

{% block page_assets %}
    {% include "modals.html" %}
    {% include "js-templates.html" %}
{% endblock %}